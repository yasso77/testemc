{% extends 'master.html' %}

{% block content %}
<style>
    /* Professional Vertical Styling */
    .form-container {
        background: #ffffff;
        padding: 40px;
        border-radius: 12px;
        box-shadow: 0 0 25px rgba(0,0,0,0.05);
        border: 1px solid #e9ecef;
    }

    /* Your Custom Header Style */
    .section-header {
        background-color: #f6f9ff;
        padding: 12px 20px;
        border-radius: 8px;
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        color: #012970;
        font-weight: 600;
        border-left: 5px solid #012970;
    }

    .section-header i {
        font-size: 1.25rem;
        margin-right: 12px;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .col-form-label {
        font-weight: 600;
        color: #444;
    }

    .text-danger {
        font-size: 0.85rem;
    }

    /* Mobile Alert Styling */
    #mobile-validation-message {
        border-radius: 8px;
        font-size: 0.9rem;
        margin-top: 10px;
    }

    .btn-submit {
        background-color: #012970;
        border-color: #012970;
        padding: 12px 40px;
        font-weight: 600;
        transition: 0.3s;
    }

    .btn-submit:hover {
        background-color: #001b4a;
        transform: translateY(-1px);
    }
</style>

<div class="pagetitle">
    <h1>New Reservation</h1>
    <nav>
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'index' %}">Home</a></li>
            <li class="breadcrumb-item">Call Center</li>
            <li class="breadcrumb-item active">Add New Reservation</li>
        </ol>
    </nav>
</div>

<section class="section">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="form-container">
                <form method="post" class="form-horizontal">
                    {% csrf_token %}

                    <div class="section-header">
                        <i class="bi bi-card-list"></i> Basic Information
                    </div>

                    <div class="form-group row">
                        <label for="{{ form.reservationCode.id_for_label }}" class="col-sm-3 col-form-label">Reservation Code</label>
                        <div class="col-sm-8">
                            {{ form.reservationCode }}
                            {% if form.reservationCode.errors %}<div class="text-danger">{{ form.reservationCode.errors }}</div>{% endif %}
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="{{ form.expectedDate.id_for_label }}" class="col-sm-3 col-form-label">Expected Date <span class="text-danger">*</span></label>
                        <div class="col-sm-8">
                            {{ form.expectedDate }}
                            {% if form.expectedDate.errors %}<div class="text-danger">{{ form.expectedDate.errors }}</div>{% endif %}
                        </div>
                    </div>

                    <div class="section-header mt-4">
                        <i class="bi bi-person-circle"></i> Patient Profile
                    </div>

                    <div class="form-group row">
                        <label for="{{ form.fullname.id_for_label }}" class="col-sm-3 col-form-label">Patient Name <span class="text-danger">*</span></label>
                        <div class="col-sm-8">
                            {% comment %} {{ form.fullname }} {% endcomment %}

                               <div class="col-sm-8">
                            <input type="text" id="id_fullname" name="fullname"  class="form-control"  required>
                            <div id="fullname-validation-message" class="alert alert-warning py-2 px-3" style="display: none;"></div>
                        </div>
                            {% if form.fullname.errors %}<div class="text-danger">{{ form.fullname.errors }}</div>{% endif %}
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="id_mobile" class="col-sm-3 col-form-label">Mobile <span class="text-danger">*</span></label>
                        <div class="col-sm-8">
                            <input type="text" id="id_mobile" name="mobile" maxlength="15" class="form-control" placeholder="01XXXXXXXXX" required>
                            <div id="mobile-validation-message" class="alert alert-warning py-2 px-3" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="{{ form.city.id_for_label }}" class="col-sm-3 col-form-label">City <span class="text-danger">*</span></label>
                        <div class="col-sm-8">{{ form.city }}</div>
                    </div>

                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">Age & Gender <span class="text-danger">*</span></label>
                        <div class="col-sm-3">
                            {{ form.age }}
                        </div>
                        <div class="col-sm-5 d-flex align-items-center">
                            {% for radio in form.gender %}
                                <div class="form-check form-check-inline ms-3">
                                    {{ radio.tag }}
                                    <label class="form-check-label">{{ radio.choice_label }}</label>
                                </div>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="section-header mt-4">
                        <i class="bi bi-briefcase"></i> Source & Pricing
                    </div>

                    <div class="form-group row">
                        <label for="{{ form.leadSource.id_for_label }}" class="col-sm-3 col-form-label">Coming Source <span class="text-danger">*</span></label>
                        <div class="col-sm-8">{{ form.leadSource }}</div>
                    </div>

                    <div class="form-group row">
                        <label for="{{ form.sufferedcase.id_for_label }}" class="col-sm-3 col-form-label">Suffered Case <span class="text-danger">*</span></label>
                        <div class="col-sm-8">{{ form.sufferedcase }}</div>
                    </div>

                    <div class="form-group row">
                        <label for="{{ form.organizationID.id_for_label }}" class="col-sm-3 col-form-label">Organization <span class="text-danger">*</span></label>
                        <div class="col-sm-8">{{ form.organizationID }}</div>
                    </div>

                    <div class="form-group row">
                        <label for="{{ form.checkUpprice.id_for_label }}" class="col-sm-3 col-form-label">Check-Up Price <span class="text-danger">*</span></label>
                        <div class="col-sm-8">
                            <div class="input-group">
                                <span class="input-group-text">EGP</span>
                                {{ form.checkUpprice }}
                            </div>
                        </div>
                    </div>

                    <div class="section-header mt-4">
                        <i class="bi bi-chat-right-text"></i> Additional Details
                    </div>

                    <div class="form-group row">
                        <label for="{{ form.offerID.id_for_label }}" class="col-sm-3 col-form-label">Offers</label>
                        <div class="col-sm-8">{{ form.offerID }}</div>
                    </div>

                    <div class="form-group row">
                        <label for="{{ form.agentID.id_for_label }}" class="col-sm-3 col-form-label">Agent/Company</label>
                        <div class="col-sm-8">{{ form.agentID }}</div>
                    </div>

                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">Call Direction</label>
                        <div class="col-sm-8 d-flex align-items-center">
                            {% for radio in form.callDirection %}
                                <div class="form-check form-check-inline me-4">
                                    {{ radio.tag }}
                                    <label class="form-check-label">{{ radio.choice_label }}</label>
                                </div>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="{{ form.remarks.id_for_label }}" class="col-sm-3 col-form-label">Remarks</label>
                        <div class="col-sm-8">{{ form.remarks }}</div>
                    </div>

                    <div class="form-group row mt-5">
                        <div class="col-sm-12 text-center">
                            <button type="submit" class="btn btn-primary btn-submit shadow-sm me-2">
                                <i class="bi bi-check2-circle me-1"></i> Create Reservation
                            </button>
                            <button type="reset" class="btn btn-outline-secondary px-4 py-2">
                                Reset
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const mobileField = document.getElementById('id_mobile');
        const messageSpan = document.getElementById('mobile-validation-message');
        
        mobileField.addEventListener('blur', function () {
            const mobile = mobileField.value;
            if (mobile) {
                fetch(`/validate-mobile/?mobile=${mobile}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.exists) {
                            messageSpan.innerHTML = `<i class="bi bi-exclamation-triangle-fill me-2"></i> This Mobile Number already exists. <a href="/reservationListMobile/${mobile}" target="_blank" class="fw-bold">View History</a>`;
                            messageSpan.style.display = 'block';
                        } else {
                            messageSpan.style.display = 'none';
                        }
                    })
                    .catch(error => console.error('Error:', error));
            }
        });
    });

     document.addEventListener('DOMContentLoaded', function () {
        const fullnameField = document.getElementById('id_fullname');
        const messageSpan = document.getElementById('fullname-validation-message');
        
        fullnameField.addEventListener('blur', function () {
            const fullname = fullnameField.value;
            if (fullname) {
                fetch(`/validate-fullname/?fullname=${fullname}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.exists) {
                            messageSpan.innerHTML = `<i class="bi bi-exclamation-triangle-fill me-2"></i> This Name already exists. <a href="/reservationListName/${fullname}" target="_blank" class="fw-bold">View History</a>`;
                            messageSpan.style.display = 'block';
                        } else {
                            messageSpan.style.display = 'none';
                        }
                    })
                    .catch(error => console.error('Error:', error));
            }
        });
    });
</script>
{% endblock %}